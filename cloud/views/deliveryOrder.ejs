<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title><%=title%></title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <link rel="icon" type="image/png" href="assets/i/favicon.png">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png">
  <meta name="msapplication-TileColor" content="#0e90d2">

  <link rel="stylesheet" href="http://cdn.amazeui.org/amazeui/2.1.0/css/amazeui.min.css">

  <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://cdn.amazeui.org/amazeui/2.1.0/js/amazeui.min.js"></script>

  <style>
    div.btn {
      align: center;
    }

    h4 {
      text-align: center;

    }

    div.ordertable {
      margin-top: 40px;
    }

    div.nonepadding {
      padding: 0px;
    }

    hr.nonemargin {
      padding: 0px;
    }
  </style>

</head>
<body style="background-color: #eeeeee">

<div id="top_alert" class="am-alert am-alert-success" data-am-alert>
  <button type="button" class="am-close">&times;</button>
  <p>接单须知:</p>
  <p>1. BLOOM要求标准化生产。接单前，请确认自己是否有相关包装及花材。</p>
  <p>2. BLOOM根据地理位置进行分单，请在自己的派送范围内接单。</p>
  <p>3. 合作方需保证，鲜花和图片一样，并且按时送达。</p>
  <p>4. 接单按日，每天第1单奖励10元，第2-9单奖励5元，第十单奖励50元。</p>
  <p>5.客户收到货后，会为花束和本次服务评分，如收到差评会影响后续接单，如果当月连续如果满100单，并且全是五星好评，奖励2000元。</p>
</div>

<div style="background-color: #ffffff;margin-left: 15px;margin-right: 15px;margin-top: 15px;">
  <div class="am-g">
        <br/>
        <div class="am-u-sm-11.5 am-u-sm-centered">
            <div class="am-u-sm-4"><h3>订单信息</h3></div>
        </div>
        <br/>
         <hr class="am-u-sm-12 nonemargin"  style="margin-top: 0px;"/>
    <div class="am-u-sm-11.5 am-u-sm-centered ">

      <div class="am-u-sm-4">订单号</div>

      <div id="orderNo" class="am-u-sm-8 nonepadding" data-am-popover="">暂无</div>

      <hr class="am-u-sm-12" style="border-style: dotted;"/>

      <div class="am-u-sm-4">下单时间</div>
      <div id="orderCreateTime" class="am-u-sm-8 nonepadding">暂无</div>
      <hr class="am-u-sm-12" style="border-style: dotted;"/>

      <div class="am-u-sm-4">订单状态</div>
            <div  class="am-u-sm-8 nonepadding " style="   display: table-cell;vertical-align: middle;">
             <p id="orderstate" class="am-u-sm-4" style="margin:0px;padding: 0px; " >暂无</p>
                <button type="button" id="complete_btn" class="am-u-sm-8 am-btn am-btn-success"><%=title%></button>
            </div>
            <hr class="am-u-sm-12" style="border-style: dotted;"/>

      <div id="report_code" class="am-input-group am-u-sm-11.5 am-u-sm-centered ">
        <input type="number" class="am-form-field" placeholder="输入配送结束确认码" id="code_input">
        <button id="repost_code_button" style="margin-top: 15px;" class="am-btn am-btn-default" type="button">
          重发收件密码
        </button>
      </div>
      <hr class="am-u-sm-12" style="visibility: hidden;margin-left: 0px;margin-right:0px;padding: 0px"/>
    </div>

  </div>
</div>

<div style="background-color: #ffffff;margin-left: 15px;margin-right: 15px;margin-top: 15px;margin-bottom: 15px;">
  <div class="am-g">
     <br/>
        <div class="am-u-sm-11.5 am-u-sm-centered">
            <div class="am-u-sm-4"><h3>配送信息</h3></div>
        </div>
        <br/>
        <hr class="am-u-sm-12 nonemargin"  style="margin-top: 0px;"/>
    <div class="am-u-sm-11.5 am-u-sm-centered ">
      <div class="am-u-sm-4">
        <figure data-am-widget="figure" class="am am-figure am-figure-ios7  "
                data-am-figure="{  pureview: 'true' }">
          <img id="flowerImage"
               src="http://amui.qiniudn.com/pure-1.jpg?imageView2/0/w/100"
               data-rel="http://amui.qiniudn.com/pure-1.jpg"
               alt=""
               style="width: auto;height: 100px;"/>
          <figcaption  class="am-figure-capition-btm"></figcaption>
        </figure>
      </div>
      <div class="am-u-sm-8 nonepadding">
                <p id="flowerName">商品名称：暂无</p>

                <p id="price">您可赚到：00.00元</p>
				<p id="cardMsg">贺卡留言：</p>
      </div>

      <hr class="am-u-sm-12" style="border-style: dotted;"/>
      <div class="am-u-sm-4" >收货人</div>
      <div id="name" class="am-u-sm-8 nonepadding">暂无</div>

      <hr class="am-u-sm-12" style="border-style: dotted;"/>
      <div class="am-u-sm-4">电话</div>
      <div id="phoneNumber"  class="am-u-sm-8 nonepadding">暂无</div>

      <hr class="am-u-sm-12" style="border-style: dotted;"/>
      <div class="am-u-sm-4">收货地址</div>
      <div id="address" class="am-u-sm-8 nonepadding">暂无</div>

      <hr class="am-u-sm-12" style="border-style: dotted;"/>
      <div class="am-u-sm-4 ">送货时间</div>
       <div  class="am-u-sm-8 nonepadding">
                <div id="deliveryFromDate">
                    暂无
                 </div>
                <div id="deliveryCountdown">
                    暂无
                </div>
            </div>
      <hr class="am-u-sm-12" style="visibility: hidden;"/>
    </div>

  </div>
</div>


<div id="reset-complete-alert" class="am-modal am-modal-alert" tabindex="-1">
  <div class="am-modal-dialog">
    <div id="alert-title" class="am-modal-hd"></div>
    <div id="alert-error-code" class="am-modal-hd"></div>
    <div id="alert-error-msg" class="am-modal-bd"></div>
    <div class="am-modal-footer">
      <span class="am-modal-btn" data-am-modal-confirm>确定</span>
    </div>
  </div>
</div>

<div id="reset-confirm" class="am-modal am-modal-confirm" tabindex="-1" >
    <div class="am-modal-dialog">
        <div id="reset-confirm-title" class="am-modal-hd"></div>
        <div id="reset-confirm-content" class="am-modal-bd"></div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
        </div>
    </div>
</div>

<script>


  var escape2Html = function (str) {
    var arrEntities = {'lt': '<', 'gt': '>', 'nbsp': ' ', 'amp': '&', 'quot': '"',"\'":"'"};
    return str.replace(/&(lt|gt|nbsp|amp|quot);/ig, function (all, t) {
      return arrEntities[t];
    });
  }

  /*
    Happy&nbsp;Valentine&#39;s&nbsp;Day.
    Happy Valentine&amp;#39;s Day.
  */
  function html_decode(str)
  {
      var s = "";
      if (str.length == 0) return "";
      s = str.replace(/&amp;/g, "&");
      s = s.replace(/&lt;/g, "<");
      s = s.replace(/&gt;/g, ">");
      s = s.replace(/&nbsp;/g, " ");
      s = s.replace(/&#39;/g, "\'");
      s = s.replace(/&quot;/g, "\"");
      s = s.replace(/<br>/g, "\n");
      return s;
  }

  var order = JSON.parse(html_decode('<%= JSON.stringify(order)%>'));
  var url = escape2Html('<%=url%>');
  var title = escape2Html('<%=title%>');
  var reportCodeURL = escape2Html('<%=reportCodeURL%>');


  $("#flowerName").text("商品名称:"+order.commodity.name); //商品名称

  $("#orderNo").text(order.orderNO);    //配送人单号
  $("#orderNo").attr("data-am-popover","{content:"+ "'"+order.orderNO+"'}");    //配送人单号

  $("#name").text(order.deliveryName);  //配送人姓名
  $("#address").text(order.deliveryAddress); //配送地址
  $("#deliveryFromDate").text(order.deliveryFromDate);  //配送日期
  $("#deliveryCountdown").text(order.deliveryCountdown);  //配送日期
  $("#price").text("您可赚到:"+order.totalCostPrice+"元"); //收益
  $("#flowerImage").attr("src", order.commodity.coverViewURL + "?imageView2/0/w/300");
  $("#flowerImage").attr("data-rel", order.commodity.coverViewURL);
  $("#introduction").text(order.commodity.introduction);
  //add
  $("#phoneNumber").text(order.deliveryPhone); //收货人电话
  $("#orderstate").text(order.deliveryStateString); //订单状态
  $("#orderCreateTime").text(order.createdAt); //下单时间
  if(order.cardMessage)
  $("#cardMsg").text("贺卡留言："+order.cardMessage); //贺卡留言


  function show_confirm() {

    alert("You pressed Cancel!");                          

  }

</script>
<script>

  var flag = false;
  $(document).ready(function () {

    $("#loading_icon").hide();
    $("#loadtiptxt").text(title);



    var complete_btn = $("button#complete_btn");
//      alert(complete_btn.html());

    if (complete_btn.html()=="已被抢单" || order.deliveryState==10)
    {
        complete_btn.hide();
        $("div#report_code").hide();
    }
    else
    {
        if (order.deliveryState == 5)
        {
            $("button#repost_code_button").click(function(){

                //成功
                $("#reset-confirm-title").text("重发收件密码");
                $("#reset-confirm-content").text("是否重新发送收件密码给用户?");
                $('#reset-confirm').modal({
                    relatedTarget: this,
                    onConfirm: function(options) {
                        //        网络请求
//                        alert(reportCodeURL);
                        $.get(reportCodeURL, function (data, status) {

                            if (status == 'success' && !data.error) {
                                //成功
                                $("#alert-title").text("成功");
                            }
                            else
                            {
                                // 失败
                                $("#alert-title").text("失败");
                                $("#alert-error-code").text("错误代码 : "+data.error.code);
                                $("#alert-error-msg").text("失败信息 : "+data.error.message);
//          alert("Data: " + data.object + "\n error: " + JSON.stringify(data.error));
                            }

                            $("#reset-complete-alert").modal();
                        });
                    },
                    onCancel: function() {

                    }
                });
            });
        }
        else
        {
            $("div#report_code").hide();
        }

        complete_btn.click(function () {

            var deliveryCode = $("#code_input").val();

            if (deliveryCode) {
                url += "&deliveryCode=" + deliveryCode
            };

//            alert(url);

            if (flag) return flag = true;

            $("#loading_icon").show();
            $("#loadtiptxt").text("加载中...");

            //网络请求
            $.get(url, function (data, status) {

                flag = false;
                $("#loading_icon").hide();
                $("#loadtiptxt").text(title);

                if (status == 'success' && !data.error) {
                    //成功
                    $("#alert-title").text("成功");

                }
                else
                {
                    // 失败
                    $("#alert-title").text("失败");
                    $("#alert-error-code").text("错误代码 : "+data.error.code);
                    $("#alert-error-msg").text("失败信息 : "+data.error.message);
//          alert("Data: " + data.object + "\n error: " + JSON.stringify(data.error));
                }

                $("#reset-complete-alert").modal({
                    relatedTarget: this,
                    onConfirm: function(e) {
                        location.reload(true);
                    }
                });
            });
        });
    }

  });
</script>

<!--????????д???Ĵ???-->

<!--[if (gte IE 9)|!(IE)]><!-->

<!--<![endif]-->
<!--[if lte IE 8 ]>


<![endif]-->
</body>
</html>
